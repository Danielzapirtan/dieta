<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dieta - Gestiunea alimenta»õiei</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: auto;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #3498db;
            color: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .regime-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .consumption-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .input-small {
            width: 80px;
            text-align: center;
        }

        .meal-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .meal-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .multiple-select {
            height: 120px;
        }

        .table-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
            font-weight: bold;
            color: #2c3e50;
        }

        .export-section {
            background: #f0f8f0;
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
            border-left: 5px solid #27ae60;
        }

        .date-selector {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .aliment-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .mancare-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .success {
            color: #27ae60;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è DIETA</h1>
            <p>Sistem de gestiune alimentarƒÉ</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="retetar">üìù Re»õetar</div>
            <div class="tab" data-tab="persoane">üë• NumƒÉr persoane</div>
            <div class="tab" data-tab="cza">üìÖ CZA</div>
            <div class="tab" data-tab="lista">üìã ListƒÉ alimente</div>
        </div>

        <!-- Tab 1: Re»õetar -->
        <div class="tab-content active" id="retetar">
            <h2>üìù Re»õetar - Gestionare m√¢ncƒÉruri »ôi alimente</h2>
            
            <div class="grid">
                <!-- AdƒÉugare m√¢ncare nouƒÉ -->
                <div class="card">
                    <h3>AdaugƒÉ m√¢ncare nouƒÉ</h3>
                    <div class="form-group">
                        <label>Nume m√¢ncare:</label>
                        <input type="text" id="nume-mancare" placeholder="Ex: CiorbƒÉ de burtƒÉ">
                    </div>
                    <button class="btn btn-success" onclick="adaugaMancare()">‚ûï AdaugƒÉ m√¢ncare</button>
                </div>

                <!-- Selectare m√¢ncare pentru editare -->
                <div class="card">
                    <h3>SelecteazƒÉ m√¢ncare pentru editare</h3>
                    <div class="form-group">
                        <label>M√¢ncare:</label>
                        <select id="select-mancare" onchange="incarcaMancare()">
                            <option value="">-- SelecteazƒÉ m√¢ncare --</option>
                        </select>
                    </div>
                    <button class="btn btn-danger" onclick="stergeMancare()">üóëÔ∏è »òterge m√¢ncare</button>
                </div>
            </div>

            <!-- AdƒÉugare alimente la m√¢ncare -->
            <div id="alimente-section" style="display: none;">
                <div class="card">
                    <h3 id="mancare-title">Alimente pentru m√¢ncare</h3>
                    
                    <div class="aliment-form">
                        <h4>AdaugƒÉ aliment nou</h4>
                        <div class="grid">
                            <div class="form-group">
                                <label>Nume aliment:</label>
                                <input type="text" id="nume-aliment" placeholder="Ex: Carne de vitƒÉ">
                            </div>
                            <div class="form-group">
                                <label>Unitatea de mƒÉsurƒÉ:</label>
                                <input type="text" id="um-aliment" placeholder="Ex: kg, buc, l">
                            </div>
                            <div class="form-group">
                                <label>Cantitate per por»õie:</label>
                                <input type="number" id="cantitate-aliment" step="0.01" placeholder="Ex: 0.15">
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="adaugaAliment()">‚ûï AdaugƒÉ aliment</button>
                    </div>

                    <div id="alimente-table-container"></div>
                </div>
            </div>

            <!-- Lista toate m√¢ncƒÉrurile -->
            <div class="card">
                <h3>Toate m√¢ncƒÉrurile din re»õetar</h3>
                <div id="toate-mancarurile"></div>
            </div>
        </div>

        <!-- Tab 2: NumƒÉr persoane -->
        <div class="tab-content" id="persoane">
            <h2>üë• NumƒÉr de persoane per regim »ôi loc de consum</h2>
            
            <div class="card">
                <h3>Configurare persoane</h3>
                <p>Introduce»õi numƒÉrul de persoane pentru fiecare regim (R1-R6) »ôi loc de consum (C1-C3):</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Regim / Loc</th>
                            <th>C1</th>
                            <th>C2</th>
                            <th>C3</th>
                        </tr>
                    </thead>
                    <tbody id="persoane-table">
                        <!-- Se populeazƒÉ automat -->
                    </tbody>
                </table>
                
                <button class="btn btn-success" onclick="salveazaPersoane()" style="margin-top: 20px;">üíæ SalveazƒÉ configura»õia</button>
            </div>
        </div>

        <!-- Tab 3: CZA -->
        <div class="tab-content" id="cza">
            <h2>üìÖ CZA - Compozi»õia zilnicƒÉ a alimentelor</h2>
            
            <div class="date-selector">
                <label><strong>üìÖ SelecteazƒÉ data:</strong></label>
                <input type="date" id="data-cza" onchange="incarcaCZA()">
            </div>

            <div id="cza-content">
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-mese">0</div>
                        <div>Mese configurate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-mancaruri">0</div>
                        <div>M√¢ncƒÉruri totale</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-persoane">0</div>
                        <div>Persoane totale</div>
                    </div>
                </div>

                <div id="mese-container">
                    <!-- Se populeazƒÉ cu mesele M1-M5 -->
                </div>

                <button class="btn btn-success" onclick="salveazaCZA()">üíæ SalveazƒÉ meniul zilnic</button>
            </div>
        </div>

        <!-- Tab 4: ListƒÉ alimente -->
        <div class="tab-content" id="lista">
            <h2>üìã ListƒÉ alimente pentru ziua selectatƒÉ</h2>
            
            <div class="date-selector">
                <label><strong>üìÖ Data pentru listƒÉ alimente:</strong></label>
                <input type="date" id="data-lista" onchange="genereazaListaAlimente()">
            </div>

            <div id="lista-content">
                <div class="export-section">
                    <h3>üì§ Export op»õiuni</h3>
                    <button class="btn btn-success" onclick="exportPDF()">üìÑ Export listƒÉ alimente (PDF)</button>
                    <button class="btn" onclick="exportMeniuPDF()">üìÑ Export meniu zilnic (PDF)</button>
                </div>

                <div id="lista-alimente-table-container"></div>
            </div>
        </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script>
        // Date globale pentru aplica»õie
        let retetar = JSON.parse(localStorage.getItem('retetar') || '{}');
        let persoane = JSON.parse(localStorage.getItem('persoane') || '{}');
        let cza = JSON.parse(localStorage.getItem('cza') || '{}');
        let mancareSelectata = '';

        // Ini»õializare aplica»õie
        document.addEventListener('DOMContentLoaded', function() {
            initializareTaburi();
            initializarePersoane();
            incarcaToateMancarurile();
            incarcaSelectMancare();
            
            // SeteazƒÉ data curentƒÉ
            const azi = new Date().toISOString().split('T')[0];
            document.getElementById('data-cza').value = azi;
            document.getElementById('data-lista').value = azi;
            
            incarcaCZA();
            genereazaListaAlimente();
        });

        // === FUNC»öII GENERALE ===
        function initializareTaburi() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // ActualizeazƒÉ taburile active
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        function salveazaDate() {
            localStorage.setItem('retetar', JSON.stringify(retetar));
            localStorage.setItem('persoane', JSON.stringify(persoane));
            localStorage.setItem('cza', JSON.stringify(cza));
        }

        // === TAB 1: RE»öETAR ===
        function adaugaMancare() {
            const nume = document.getElementById('nume-mancare').value.trim();
            if (!nume) {
                alert('Introduce»õi numele m√¢ncƒÉrii!');
                return;
            }
            
            if (retetar[nume]) {
                alert('AceastƒÉ m√¢ncare existƒÉ already √Æn re»õetar!');
                return;
            }
            
            retetar[nume] = {};
            document.getElementById('nume-mancare').value = '';
            
            salveazaDate();
            incarcaToateMancarurile();
            incarcaSelectMancare();
            
            alert('M√¢ncare adƒÉugatƒÉ cu succes!');
        }

        function incarcaSelectMancare() {
            const select = document.getElementById('select-mancare');
            select.innerHTML = '<option value="">-- SelecteazƒÉ m√¢ncare --</option>';
            
            Object.keys(retetar).forEach(nume => {
                const option = document.createElement('option');
                option.value = nume;
                option.textContent = nume;
                select.appendChild(option);
            });
        }

        function incarcaMancare() {
            mancareSelectata = document.getElementById('select-mancare').value;
            
            if (!mancareSelectata) {
                document.getElementById('alimente-section').style.display = 'none';
                return;
            }
            
            document.getElementById('alimente-section').style.display = 'block';
            document.getElementById('mancare-title').textContent = `Alimente pentru: ${mancareSelectata}`;
            
            incarcaAlimenteTable();
        }

        function stergeMancare() {
            if (!mancareSelectata) {
                alert('Selecta»õi o m√¢ncare pentru »ôtergere!');
                return;
            }
            
            if (confirm(`Confirma»õi »ôtergerea m√¢ncƒÉrii "${mancareSelectata}"?`)) {
                delete retetar[mancareSelectata];
                mancareSelectata = '';
                
                document.getElementById('select-mancare').value = '';
                document.getElementById('alimente-section').style.display = 'none';
                
                salveazaDate();
                incarcaToateMancarurile();
                incarcaSelectMancare();
                
                alert('M√¢ncare »ôtearsƒÉ cu succes!');
            }
        }

        function adaugaAliment() {
            if (!mancareSelectata) {
                alert('Selecta»õi mai √Ænt√¢i o m√¢ncare!');
                return;
            }
            
            const nume = document.getElementById('nume-aliment').value.trim();
            const um = document.getElementById('um-aliment').value.trim();
            const cantitate = parseFloat(document.getElementById('cantitate-aliment').value);
            
            if (!nume || !um || isNaN(cantitate) || cantitate <= 0) {
                alert('Completa»õi toate c√¢mpurile cu valori valide!');
                return;
            }
            
            if (retetar[mancareSelectata][nume]) {
                alert('Acest aliment existƒÉ deja pentru aceastƒÉ m√¢ncare!');
                return;
            }
            
            retetar[mancareSelectata][nume] = {
                um: um,
                cantitate: cantitate
            };
            
            // ReseteazƒÉ formularul
            document.getElementById('nume-aliment').value = '';
            document.getElementById('um-aliment').value = '';
            document.getElementById('cantitate-aliment').value = '';
            
            salveazaDate();
            incarcaAlimenteTable();
            
            alert('Aliment adƒÉugat cu succes!');
        }

        function incarcaAlimenteTable() {
            const container = document.getElementById('alimente-table-container');
            
            if (!mancareSelectata || !retetar[mancareSelectata]) {
                container.innerHTML = '';
                return;
            }
            
            const alimente = retetar[mancareSelectata];
            
            if (Object.keys(alimente).length === 0) {
                container.innerHTML = '<p>Nu existƒÉ alimente pentru aceastƒÉ m√¢ncare.</p>';
                return;
            }
            
            let html = '<table><thead><tr><th>Aliment</th><th>UM</th><th>Cantitate/por»õie</th><th>Ac»õiuni</th></tr></thead><tbody>';
            
            Object.entries(alimente).forEach(([nume, data]) => {
                html += `<tr>
                    <td>${nume}</td>
                    <td>${data.um}</td>
                    <td>${data.cantitate}</td>
                    <td><button class="btn btn-danger" onclick="stergeAliment('${nume}')">üóëÔ∏è »òterge</button></td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function stergeAliment(nume) {
            if (confirm(`Confirma»õi »ôtergerea alimentului "${nume}"?`)) {
                delete retetar[mancareSelectata][nume];
                salveazaDate();
                incarcaAlimenteTable();
                alert('Aliment »ôters cu succes!');
            }
        }

        function incarcaToateMancarurile() {
            const container = document.getElementById('toate-mancarurile');
            
            if (Object.keys(retetar).length === 0) {
                container.innerHTML = '<p>Nu existƒÉ m√¢ncƒÉruri √Æn re»õetar.</p>';
                return;
            }
            
            let html = '';
            Object.entries(retetar).forEach(([numeMancare, alimente]) => {
                html += `<div class="mancare-item">
                    <h4>${numeMancare}</h4>
                    <p><strong>Alimente (${Object.keys(alimente).length}):</strong> ${Object.keys(alimente).join(', ') || 'Niciun aliment'}</p>
                </div>`;
            });
            
            container.innerHTML = html;
        }

        // === TAB 2: PERSOANE ===
        function initializarePersoane() {
            // Ini»õializeazƒÉ structura persoanelor dacƒÉ nu existƒÉ
            if (!persoane.regimuri) {
                persoane = {
                    regimuri: {}
                };
                
                for (let r = 1; r <= 6; r++) {
                    persoane.regimuri[`R${r}`] = {
                        C1: 0,
                        C2: 0,
                        C3: 0
                    };
                }
                
                salveazaDate();
            }
            
            incarcaTabelPersoane();
        }

        function incarcaTabelPersoane() {
            const tbody = document.getElementById('persoane-table');
            let html = '';
            
            for (let r = 1; r <= 6; r++) {
                const regim = `R${r}`;
                html += `<tr>
                    <td><strong>${regim}</strong></td>
                    <td><input type="number" class="input-small" min="0" max="127" value="${persoane.regimuri[regim].C1}" id="persoane-${regim}-C1"></td>
                    <td><input type="number" class="input-small" min="0" max="127" value="${persoane.regimuri[regim].C2}" id="persoane-${regim}-C2"></td>
                    <td><input type="number" class="input-small" min="0" max="127" value="${persoane.regimuri[regim].C3}" id="persoane-${regim}-C3"></td>
                </tr>`;
            }
            
            tbody.innerHTML = html;
        }

        function salveazaPersoane() {
            for (let r = 1; r <= 6; r++) {
                const regim = `R${r}`;
                for (let c = 1; c <= 3; c++) {
                    const loc = `C${c}`;
                    const valoare = parseInt(document.getElementById(`persoane-${regim}-${loc}`).value) || 0;
                    persoane.regimuri[regim][loc] = Math.min(127, Math.max(0, valoare));
                }
            }
            
            salveazaDate();
            alert('Configura»õia persoanelor a fost salvatƒÉ!');
        }

        // === TAB 3: CZA ===
        function incarcaCZA() {
            const data = document.getElementById('data-cza').value;
            if (!data) return;
            
            if (!cza[data]) {
                cza[data] = {};
                for (let m = 1; m <= 5; m++) {
                    cza[data][`M${m}`] = {};
                }
                salveazaDate();
            }
            
            genereazaMese();
            actualizeazaStatistici();
        }

        function genereazaMese() {
            const container = document.getElementById('mese-container');
            const data = document.getElementById('data-cza').value;
            
            let html = '';
            
            for (let m = 1; m <= 5; m++) {
                const masa = `M${m}`;
                html += `<div class="meal-section">
                    <div class="meal-title">üçΩÔ∏è Masa ${m} (${masa})</div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label>SelecteazƒÉ m√¢ncƒÉrile:</label>
                            <select multiple class="multiple-select" id="mancaruri-${masa}">
                                ${Object.keys(retetar).map(nume => 
                                    `<option value="${nume}" ${cza[data][masa][nume] ? 'selected' : ''}>${nume}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Regimuri (Ctrl+click pentru selec»õie multiplƒÉ):</label>
                            <select multiple class="multiple-select" id="regimuri-${masa}">
                                ${Array.from({length: 6}, (_, i) => {
                                    const regim = `R${i+1}`;
                                    return `<option value="${regim}">${regim}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="actualizeazaMasa('${masa}')">üîÑ ActualizeazƒÉ masa</button>
                    
                    <div id="tabele-${masa}"></div>
                </div>`;
            }
            
            container.innerHTML = html;
            
            // √éncarcƒÉ tabelele existente
            for (let m = 1; m <= 5; m++) {
                genereazaTabeleMasa(`M${m}`);
            }
        }

        function actualizeazaMasa(masa) {
            const data = document.getElementById('data-cza').value;
            const mancaruriSelect = document.getElementById(`mancaruri-${masa}`);
            const regimuriSelect = document.getElementById(`regimuri-${masa}`);
            
            const mancaruriSelectate = Array.from(mancaruriSelect.selectedOptions).map(opt => opt.value);
            const regimuriSelectate = Array.from(regimuriSelect.selectedOptions).map(opt => opt.value);
            
            // ReseteazƒÉ masa
            cza[data][masa] = {};
            
            // AdaugƒÉ combina»õiile selectate
            mancaruriSelectate.forEach(mancare => {
                if (!cza[data][masa][mancare]) {
                    cza[data][masa][mancare] = {};
                }
                
                regimuriSelectate.forEach(regim => {
                    cza[data][masa][mancare][regim] = {
                        C1: true,
                        C2: true,
                        C3: true
                    };
                });
            });
            
            salveazaDate();
            genereazaTabeleMasa(masa);
            actualizeazaStatistici();
        }

        function genereazaTabeleMasa(masa) {
            const data = document.getElementById('data-cza').value;
            const container = document.getElementById(`tabele-${masa}`);
            
            if (!cza[data] || !cza[data][masa]) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            Object.entries(cza[data][masa]).forEach(([mancare,regimuri]) => {
            if (Object.keys(regimuri).length === 0) return;
            
            html += `<div class="card">
                <h4>üçΩÔ∏è ${mancare}</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Regim</th>
                            <th>C1</th>
                            <th>C2</th>
                            <th>C3</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            Object.entries(regimuri).forEach(([regim, locuri]) => {
                html += `<tr>
                    <td><strong>${regim}</strong></td>
                    <td><input type="checkbox" ${locuri.C1 ? 'checked' : ''} onchange="toggleConsum('${data}', '${masa}', '${mancare}', '${regim}', 'C1', this.checked)"></td>
                    <td><input type="checkbox" ${locuri.C2 ? 'checked' : ''} onchange="toggleConsum('${data}', '${masa}', '${mancare}', '${regim}', 'C2', this.checked)"></td>
                    <td><input type="checkbox" ${locuri.C3 ? 'checked' : ''} onchange="toggleConsum('${data}', '${masa}', '${mancare}', '${regim}', 'C3', this.checked)"></td>
                </tr>`;
            });
            
            html += `</tbody></table>
                <button class="btn btn-danger" onclick="stergeMancareaDinMasa('${data}', '${masa}', '${mancare}')">üóëÔ∏è »òterge din masƒÉ</button>
            </div>`;
        });
        
        container.innerHTML = html;
    }

    function toggleConsum(data, masa, mancare, regim, loc, checked) {
        if (!cza[data][masa][mancare][regim]) {
            cza[data][masa][mancare][regim] = {};
        }
        cza[data][masa][mancare][regim][loc] = checked;
        salveazaDate();
        actualizeazaStatistici();
    }

    function stergeMancareaDinMasa(data, masa, mancare) {
        if (confirm(`Confirma»õi »ôtergerea m√¢ncƒÉrii "${mancare}" din ${masa}?`)) {
            delete cza[data][masa][mancare];
            salveazaDate();
            genereazaTabeleMasa(masa);
            actualizeazaStatistici();
        }
    }

    function actualizeazaStatistici() {
        const data = document.getElementById('data-cza').value;
        if (!data || !cza[data]) return;
        
        let totalMese = 0;
        let totalMancaruri = 0;
        let totalPersoane = 0;
        
        Object.values(cza[data]).forEach(masa => {
            if (Object.keys(masa).length > 0) {
                totalMese++;
                totalMancaruri += Object.keys(masa).length;
            }
        });
        
        // CalculeazƒÉ total persoane din configura»õie
        Object.values(persoane.regimuri || {}).forEach(regim => {
            totalPersoane += (regim.C1 || 0) + (regim.C2 || 0) + (regim.C3 || 0);
        });
        
        document.getElementById('total-mese').textContent = totalMese;
        document.getElementById('total-mancaruri').textContent = totalMancaruri;
        document.getElementById('total-persoane').textContent = totalPersoane;
    }

    function salveazaCZA() {
        salveazaDate();
        alert('Meniul zilnic a fost salvat cu succes!');
    }

    // === TAB 4: LISTƒÇ ALIMENTE ===
    function genereazaListaAlimente() {
        const data = document.getElementById('data-lista').value;
        if (!data || !cza[data]) {
            document.getElementById('lista-alimente-table-container').innerHTML = '<p>Nu existƒÉ date pentru aceastƒÉ datƒÉ.</p>';
            return;
        }
        
        const alimenteConsolidate = {};
        
        // Parcurge toate mesele din ziua selectatƒÉ
        Object.entries(cza[data]).forEach(([masa, mancaruri]) => {
            Object.entries(mancaruri).forEach(([numeMancare, regimuri]) => {
                if (!retetar[numeMancare]) return;
                
                Object.entries(regimuri).forEach(([regim, locuri]) => {
                    Object.entries(locuri).forEach(([loc, activ]) => {
                        if (!activ || !persoane.regimuri || !persoane.regimuri[regim]) return;
                        
                        const numarPersoane = persoane.regimuri[regim][loc] || 0;
                        if (numarPersoane === 0) return;
                        
                        // Parcurge alimentele din m√¢ncare
                        Object.entries(retetar[numeMancare]).forEach(([numeAliment, dataAliment]) => {
                            const cantitateNecesara = dataAliment.cantitate * numarPersoane;
                            
                            if (!alimenteConsolidate[numeAliment]) {
                                alimenteConsolidate[numeAliment] = {
                                    um: dataAliment.um,
                                    cantitate: 0,
                                    detalii: []
                                };
                            }
                            
                            alimenteConsolidate[numeAliment].cantitate += cantitateNecesara;
                            alimenteConsolidate[numeAliment].detalii.push({
                                masa: masa,
                                mancare: numeMancare,
                                regim: regim,
                                loc: loc,
                                persoane: numarPersoane,
                                cantitate: cantitateNecesara
                            });
                        });
                    });
                });
            });
        });
        
        afiseazaTabelAlimente(alimenteConsolidate, data);
    }

    function afiseazaTabelAlimente(alimente, data) {
        const container = document.getElementById('lista-alimente-table-container');
        
        if (Object.keys(alimente).length === 0) {
            container.innerHTML = '<p>Nu sunt necesare alimente pentru aceastƒÉ datƒÉ.</p>';
            return;
        }
        
        let html = `
            <div class="table-info">
                üìÖ ListƒÉ alimente pentru data: <strong>${data}</strong><br>
                üìä Total alimente: <strong>${Object.keys(alimente).length}</strong>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Aliment</th>
                        <th>UM</th>
                        <th>Cantitate totalƒÉ</th>
                        <th>Detalii</th>
                    </tr>
                </thead>
                <tbody>`;
        
        // SorteazƒÉ alimentele alfabetic
        const alimenteSortate = Object.entries(alimente).sort((a, b) => a[0].localeCompare(b[0]));
        
        alimenteSortate.forEach(([nume, data]) => {
            const cantitateRotunjita = Math.round(data.cantitate * 1000) / 1000; // 3 zecimale
            
            let detaliiHtml = '<ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">';
            data.detalii.forEach(detaliu => {
                const cantitateDetaliu = Math.round(detaliu.cantitate * 1000) / 1000;
                detaliiHtml += `<li>${detaliu.masa}: ${detaliu.mancare} (${detaliu.regim}-${detaliu.loc}, ${detaliu.persoane} pers., ${cantitateDetaliu} ${data.um})</li>`;
            });
            detaliiHtml += '</ul>';
            
            html += `<tr>
                <td><strong>${nume}</strong></td>
                <td>${data.um}</td>
                <td><strong>${cantitateRotunjita}</strong></td>
                <td>${detaliiHtml}</td>
            </tr>`;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // === FUNC»öII EXPORT PDF ===
    function exportPDF() {
        const data = document.getElementById('data-lista').value;
        if (!data) {
            alert('Selecta»õi o datƒÉ pentru export!');
            return;
        }
        
        const doc = new jspdf.jsPDF();
        
        // Header
        doc.setFontSize(20);
        doc.text('LISTA ALIMENTE', 105, 20, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text(`Data: ${data}`, 20, 35);
        doc.text(`Generat: ${new Date().toLocaleString('ro-RO')}`, 20, 45);
        
        // CalculeazƒÉ alimentele pentru export
        const alimenteConsolidate = calculeazaAlimentePentruData(data);
        
        if (Object.keys(alimenteConsolidate).length === 0) {
            doc.text('Nu sunt alimente necesare pentru aceastƒÉ datƒÉ.', 20, 60);
        } else {
            let y = 60;
            doc.setFontSize(14);
            doc.text('ALIMENTE NECESARE:', 20, y);
            y += 15;
            
            doc.setFontSize(10);
            const alimenteSortate = Object.entries(alimenteConsolidate).sort((a, b) => a[0].localeCompare(b[0]));
            
            alimenteSortate.forEach(([nume, dataAliment]) => {
                const cantitate = Math.round(dataAliment.cantitate * 1000) / 1000;
                const text = `‚Ä¢ ${nume}: ${cantitate} ${dataAliment.um}`;
                
                // VerificƒÉ dacƒÉ textul √Æncape pe paginƒÉ
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                
                doc.text(text, 25, y);
                y += 7;
            });
        }
        
        // SalveazƒÉ PDF
        doc.save(`lista-alimente-${data}.pdf`);
    }

    function exportMeniuPDF() {
        const data = document.getElementById('data-lista').value;
        if (!data || !cza[data]) {
            alert('Nu existƒÉ meniu pentru aceastƒÉ datƒÉ!');
            return;
        }
        
        const doc = new jspdf.jsPDF();
        
        // Header
        doc.setFontSize(20);
        doc.text('MENIU ZILNIC', 105, 20, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text(`Data: ${data}`, 20, 35);
        doc.text(`Generat: ${new Date().toLocaleString('ro-RO')}`, 20, 45);
        
        let y = 60;
        
        // Parcurge mesele
        for (let m = 1; m <= 5; m++) {
            const masa = `M${m}`;
            const mancaruriMasa = cza[data][masa];
            
            if (!mancaruriMasa || Object.keys(mancaruriMasa).length === 0) continue;
            
            // VerificƒÉ spa»õiul pentru nouƒÉ masƒÉ
            if (y > 230) {
                doc.addPage();
                y = 20;
            }
            
            doc.setFontSize(14);
            doc.text(`MASA ${m}`, 20, y);
            y += 10;
            
            doc.setFontSize(10);
            Object.entries(mancaruriMasa).forEach(([mancare, regimuri]) => {
                doc.text(`‚Ä¢ ${mancare}`, 25, y);
                y += 6;
                
                // Afi»ôeazƒÉ regimurile »ôi locurile
                Object.entries(regimuri).forEach(([regim, locuri]) => {
                    const locuriActive = Object.entries(locuri).filter(([loc, activ]) => activ).map(([loc]) => loc);
                    if (locuriActive.length > 0) {
                        doc.text(`  ${regim}: ${locuriActive.join(', ')}`, 30, y);
                        y += 5;
                    }
                });
                
                y += 3; // Spa»õiu √Æntre m√¢ncƒÉruri
            });
            
            y += 10; // Spa»õiu √Æntre mese
        }
        
        doc.save(`meniu-zilnic-${data}.pdf`);
    }

    function calculeazaAlimentePentruData(data) {
        if (!cza[data]) return {};
        
        const alimenteConsolidate = {};
        
        Object.entries(cza[data]).forEach(([masa, mancaruri]) => {
            Object.entries(mancaruri).forEach(([numeMancare, regimuri]) => {
                if (!retetar[numeMancare]) return;
                
                Object.entries(regimuri).forEach(([regim, locuri]) => {
                    Object.entries(locuri).forEach(([loc, activ]) => {
                        if (!activ || !persoane.regimuri || !persoane.regimuri[regim]) return;
                        
                        const numarPersoane = persoane.regimuri[regim][loc] || 0;
                        if (numarPersoane === 0) return;
                        
                        Object.entries(retetar[numeMancare]).forEach(([numeAliment, dataAliment]) => {
                            const cantitateNecesara = dataAliment.cantitate * numarPersoane;
                            
                            if (!alimenteConsolidate[numeAliment]) {
                                alimenteConsolidate[numeAliment] = {
                                    um: dataAliment.um,
                                    cantitate: 0
                                };
                            }
                            
                            alimenteConsolidate[numeAliment].cantitate += cantitateNecesara;
                        });
                    });
                });
            });
        });
        
        return alimenteConsolidate;
    }

    // === FUNC»öII UTILITARE ===
    function formatData(data) {
        const date = new Date(data);
        return date.toLocaleDateString('ro-RO', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    // === BACKUP »òI RESTAURARE ===
    function exportDate() {
        const dataExport = {
            retetar: retetar,
            persoane: persoane,
            cza: cza,
            versiune: '1.0',
            dataExport: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(dataExport, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `dieta-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
    }

    function importDate(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                if (confirm('AceastƒÉ opera»õie va suprascrie toate datele existente. Continua»õi?')) {
                    retetar = data.retetar || {};
                    persoane = data.persoane || {};
                    cza = data.cza || {};
                    
                    salveazaDate();
                    
                    // Re√ÆncarcƒÉ interfa»õa
                    initializarePersoane();
                    incarcaToateMancarurile();
                    incarcaSelectMancare();
                    incarcaCZA();
                    genereazaListaAlimente();
                    
                    alert('Date importate cu succes!');
                }
            } catch (error) {
                alert('Eroare la importul datelor: ' + error.message);
            }
        };
        reader.readAsText(file);
    }

    // === EVENIMENTE GLOBALE ===
    window.addEventListener('beforeunload', function(e) {
        // SalveazƒÉ automat datele √Ænainte de √Ænchiderea paginii
        salveazaDate();
    });

    // Salvare automatƒÉ la fiecare 30 de secunde
    setInterval(salveazaDate, 30000);
    </script>
    
    <!-- Butoane pentru backup/restore -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button class="btn" onclick="exportDate()" title="Export date">üíæ Backup</button>
        <input type="file" id="import-file" accept=".json" onchange="importDate(event)" style="display: none;">
        <button class="btn" onclick="document.getElementById('import-file').click()" title="Import date">üìÅ Restore</button>
    </div>
</body>
</html>
